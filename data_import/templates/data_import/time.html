{% extends "data_import/base.html" %}
{% block title %}{% if title %}{{ title }}{% endif %}{% endblock %}
<!--
{% block pagejs %}
<script type="text/javascript" src="/static/data_import/libs/echarts/echarts.js"></script>
{% endblock pagejs %}
-->
{% block content %}


<h2>销售部分：时间分析</h2> 
<h5><a href='/space'>跳转到：空间分析</a></h5>
{% csrf_token %}
<h3> 输入 </h3>
分析模块:
<select name="select_module" id="select_module" class="xla_1">
    <!--<option value="1">空间分析</option>-->
    <option value="2">时间分析</option>
    <!--<option value="3">钢种分析</option>
    <option value="4">客户分析</option>-->
</select>
分析内容:
<select name="select_aspect" id="select_aspect" class="xla_2">
    <option value="1">总销量</option>
    <option value="2">总销售额</option>
    <option value="3">退货率</option>
    <option value="4">质量问题个数</option>
</select>
起始时间: <input name="select_date1" id="select_date1" type="date"  value = '2016-01-01' / >
终止时间: <input name="select_date2" id="select_date2" type="date"  value = '2016-01-15' / >
时间选择依据:
<select name="select_time_choose" id="select_time_choose" class="xla_3">
    <option value="1">订单时间</option>
    <option value="2">发货时间</option>
    <option value="3">出货销账时间</option>
    <option value="4">派车结算时间</option>
    <option value="5">装车通知时间</option>
    <option value="6">订单存货时间</option>
    <option value="7">质保书时间</option>
    <option value="8">外库接收时间</option>
</select><br>
地点范围:
<select name="select_space" id="select_space" class="xla_4" value = '中国范围内'>
    <option value="0" selected >--请选择--</option>
    <option value="1">世界范围内</option>
    <option value="2">中国范围内</option>
    <option value="3">山东省内</option>
</select>
<select name="select_space_country" id="select_space_country" class="xla_5"   style="display:none;" value = 'China'>
    <!--<option value="1" selected >==请选择国家==</option>-->
    <option value="China">中国</option>
    <option value="Armenia">美国</option>
    <option value="Afghanistan">阿富汗</option>
</select>
<select name="select_space_province" id="select_space_province" class="xla_6"  style="display:none;" value = '江苏'>
    <!--<option value="1" selected >==请选择省==</option>-->
    <option value="江苏">江苏</option>
    <option value="山东">山东</option>
    <option value="黑龙江">黑龙江</option>
</select>
<select name="select_space_city" id="select_space_city" class="xla_7" style="display:none;" value = '青岛'>
    <<!--option value="1" selected >==请选择城市==</option>-->
    <option value="青岛">青岛</option>
    <option value="烟台">烟台</option>
    <option value="威海">威海</option>
</select><br>
钢种选择:
<input type="checkbox" name="select_tradeNo" id="select_tradeNo" value=45>45
<input type="checkbox" name="select_tradeNo" id="select_tradeNo" value=50>50
<input type="checkbox" name="select_tradeNo" id="select_tradeNo" value=C82DA>C82DA
<input type="checkbox" name="select_tradeNo" id="select_tradeNo" value=60Si2Mn>60Si2Mn
<input type="checkbox" name="select_tradeNo" id="select_tradeNo" value=C82A>C82A


<!--
<select name="select_trade" id="select_trade" class="xla_5">
    <option value=45>45</option>
    <option value=50>50</option>
    <option value=C82DA>C82DA</option>
</select><br>

style="visibility: hidden;"

-->

<h3> 输出 </h3>
<button id="btnDrawChart" >分析结果绘图</button>
<div id="main4" style="width: 800px;height:400px;"></div>
<div id="main5" style="width: 60px;height:400px;">
<textarea id="txt" style="width: 1000px;height:200px;"></textarea>
</div>

<script type="text/javascript">

    select_space.onchange = function(){  //控制在选择地点范围后，选择细分的地点名称
        if(this.value=='1'){ 
            document.getElementById("select_space_country").style.display = 'inline';
            document.getElementById("select_space_province").style.display = 'none';
            document.getElementById("select_space_city").style.display = 'none';
        }else if (this.value=='2'){ 
            document.getElementById("select_space_province").style.display = 'inline';
            document.getElementById("select_space_country").style.display = 'none';
            document.getElementById("select_space_city").style.display = 'none';
        } else { 
            document.getElementById("select_space_city").style.display = 'inline';
            document.getElementById("select_space_province").style.display = 'none';
            document.getElementById("select_space_country").style.display = 'none';
        } 
    }


    $('#btnDrawChart').click(function(){
        var module = $ ("#select_module").find("option:selected").val();
        var aspect = $ ("#select_aspect").find("option:selected").val();
        var dateChoose = $ ("#select_time_choose").find("option:selected").val();
        var space = $ ("#select_space").find("option:selected").val();
        var tradeNo = $ ("#select_trade").find("option:selected").val()
        
        var sql_cust = ''
        var sql_date1_ = document.getElementById("select_date1").value
        sql_date1_1 = sql_date1_.substring(0, 4)
        sql_date1_2 = sql_date1_.substring(5, 7)
        sql_date1_3 = sql_date1_.substring(8)
        sql_date1 = sql_date1_1 + sql_date1_2 + sql_date1_3 
        var sql_date2_ = document.getElementById("select_date2").value
        sql_date2_1 = sql_date2_.substring(0, 4)
        sql_date2_2 = sql_date2_.substring(5, 7)
        sql_date2_3 = sql_date2_.substring(8)
        sql_date2 = sql_date2_1 + sql_date2_2 + sql_date2_3


        if ( space == 1 ){
            var space_name = $ ("#select_space_country").find("option:selected").val();
        }else if ( space == 2 ){
            var space_name = $ ("#select_space_province").find("option:selected").val();
        }else{
            var space_name = $ ("#select_space_city").find("option:selected").val();
        }

        var arr = new Array();
        var tradeNoNoNo = ""
        comma = ","
        var items = document.getElementsByName("select_tradeNo");                 
        for (i = 0; i < items.length; i++) {                    
            if (items[i].checked) {                        
                arr.push(items[i].value);
                if (tradeNoNoNo == ""){
                    tradeNoNoNo = tradeNoNoNo + items[i].value;
                }else{
                    tradeNoNoNo = tradeNoNoNo + comma + items[i].value;
                }
            }                
        }                 
        //console.log(arr);            
        //console.log(tradeNoNoNo); 
        //console.log(tradeNo);
        var dateChoose_name = ''
        if (dateChoose == 1){
            dateChoose_name = '订单时间';
        }else if (dateChoose == 2){
            dateChoose_name = '发货时间';
        }else if(dateChoose == 3){
            dateChoose_name = '出货销账时间';
        }else if(dateChoose == 4){
            dateChoose_name = '派车结算时间';
        }else if (dateChoose == 5){
            dateChoose_name = '装车通知时间';
        }else if(dateChoose == 6){
            dateChoose_name = '订单存货时间';
        }else if(dateChoose == 7){
            dateChoose_name = '质保书时间';
        }else if(dateChoose == 8){
            dateChoose_name = '外库接收时间';
        }else{
            dateChoose_name = '时间选择选项输入错误';
        }


        
        $.ajax({
            type: "post",
            url:  "/time",
            data: {'module':module,'aspect':aspect,'dateChoose':dateChoose,'space':space,'tradeNo':tradeNoNoNo,'sql_date1':sql_date1,'sql_date2':sql_date2,'sql_cust':sql_cust,'space_detail':space_name,'csrfmiddlewaretoken':$('input[name=csrfmiddlewaretoken]').val()}
            
            }
        ).done(function(data) {
            console.log(JSON.stringify(data.result));
            drawTimeLineBar(data.result,tradeNoNoNo,data.aspect_name,data.unite,data.maxValue,data.module_name,sql_date1_,sql_date2_,dateChoose_name,space_name);
            //drawTimeLineBar2(data.result,tradeNoNoNo,data.aspect_name,data.unite,data.maxValue,data.module_name,sql_date1_,sql_date2_,dateChoose_name,space_name);
            console.log(module,aspect,dateChoose,space,tradeNoNoNo,sql_date1,sql_date2,sql_cust,space_name);
            //console.log(sql_date1)
            //console.log(sql_date2)
            //console.log(data.unite)
            var txt=$("#txt");
            var label=$("#label")
                txt.append(data.describe); 
             }).fail(function(){
                console.log("wrong");
             });
    });

 
</script>
<script type="text/javascript" src="/static/data_import/js/loadChart.js"></script>
<!-- <script type="text/javascript">
    require.config({
            paths: {
                echarts: 'http://echarts.baidu.com/build/dist'
            }
        });
</script> -->
{% endblock %}