{% extends "data_import/base.html" %}
{% block title %}{% if title %}{{ title }}{% endif %}{% endblock %}
{% block content %}

<h2>青钢转炉数据分析</h2>
<h5><a href='/fluctuation'>波动率相关分析</a></h5>

<div>
    <p><strong>1.钢种、班次、班别、工位筛选条件下的字段统计情况：</strong></p>
    钢种：<select name="gk_no1" id="gk_no1" class="gangzhong_name"></select>
    班次：<select name="OPERATESHIFT" id="OPERATESHIFT" class="OPERATESHIFT_name">
        <option value='blank' selected = "selected"></option>
        <option value=1>白班</option>
        <option value=2>中班</option>
        <option value=3>夜班</option>
    </select>
    班别：<select name="OPERATECREW" id="OPERATECREW" class="OPERATECREW_name">
        <option value='blank' selected = "selected"></option>
        <option value='A'>甲班</option>
        <option value='B'>乙班</option>
        <option value='C'>丙班</option>
    </select>
    工位：<select name="station" id="station" class="station_name">
        <option value='blank' selected = "selected"></option>
        <option value='BOF1'>BOF1</option>
        <option value='BOF2'>BOF2</option>
        <option value='BOF3'>BOF3</option>
    </select>
    字段名<select name="bookno2" id="bookno2" class="procedurename1"></select>
    <button onclick='multi_analy()' id='multi_analy'>综合统计分析</button>
</div>
    <p>注：当四个筛选条件同时生效时，满足的数据量很少，甚至无该条件下的数据。</p>
-------------------------------------------------------------------------------
<div>
    <p><strong>2.单炉次投入成本及产品产出统计情况：</strong></p>
    <p>请输入要选择的炉次号，例如：1634230</p>
    炉次号：<input type="text" name="prime_analyse" value="{{current_tableno}}" id="prime_analyse">
    <button onclick='cost()' id='click2'>投入成本分析结果</button>
    <button onclick='produce()' id='click3'>产出产品分析结果</button>
</div>
-------------------------------------------------------------------------------
<div>
    <p><strong>3.单炉次因素偏高偏低展示:</strong></p>
    炉次号：<input type="text" name="field1" value="{{current_tableno}}" id="field1">
    字段名：<select name="bookno1" id="bookno1" class="procedurename1"></select>
    <button onclick='ch_num2()' id='click4'>因素分析结果</button>
</div>

<div id="main1" style="width: 800px;height:500px;"></div>
<br>
<div id="main2" style="width: 60px;height:400px;"><textarea id="txt" style="width: 800px;height:100px;"></textarea></div>
<script type="text/javascript" src="/static/data_import/js/loadChart_chen.js"></script>
<script type="text/javascript" src="/static/data_import/js/loadParam.js"></script>
<script type="text/javascript"> 
    //多条件综合筛选
    function multi_analy(){
        var bookno = $("#bookno2").val();//字段，需要转化为大写
        var gk_no = $("#gk_no1").val();//钢种,不用转化为大写
        var OPERATESHIFT = $("#OPERATESHIFT").val();//班次
        var OPERATECREW = $("#OPERATECREW").val();//班别
        var station = $("#station").val();//工位
        alert("gk_no:"+gk_no+"\nOPERATESHIFT:"+OPERATESHIFT+"\nOPERATECREW:"+OPERATECREW+"\nstation:"+station+"\nbookno:"+bookno);
        $.ajax({
            type: "post",
            url:  "/multi_analy",
            data: {'bookno':bookno,'gk_no':gk_no,'OPERATESHIFT':OPERATESHIFT,'OPERATECREW':OPERATECREW,'station':station},
            error: function() {
                alert("发生错误，可能是无该筛选条件下的数据！");
            },
            success: function(data) {
                //alert("multi_analy");
                alert(data.state);
                //alert(data.result);
                //alert(data.result.xname)
                //alert(data.result.yvalue)
                drawBarChart2(data.result)
            }
         })
    }

    //成本消耗
    function cost(){
        var prime_analyse = $("#prime_analyse").val();
        console.log(prime_analyse)
        $.ajax({
            type: "post",
            url:  "/cost",
            data: {'prime_cost':prime_analyse},
            error: function() {
                alert("错误！！");
            },
            success: function(data) {
                //alert(data.result);
                //alert(data.result.xname)
                //alert(data.result.yvalue)
                drawBarChart(data.result);
            }
        })
    };   
    //产品产出
    function produce(){
         var prime_analyse = $("#prime_analyse").val();
        console.log(prime_analyse)
        $.ajax({
            type: "post",
            url:  "/produce",
            data: {'prime_produce':prime_analyse},
            error: function() {
                alert("错误！！");
            },
            success: function(data) {
                //alert(data.result)
                //alert(data.result.xname)
                //alert(data.result.yvalue)
                drawBarChart(data.result)
            }
        })
    };  

    //带因素偏高偏低不带钢种的单字段统计
    function ch_num2(){
        var field1 = $("#field1").val();//炉次号
        //var field2 = $("#field2").val();//字段
        var field2 = $("#bookno1").find("option:selected").val();
        var typee=1;
        console.log(field1,field2)
            $.ajax({
            type: "post",
            url:  "/ch_num2",
            data: {'heat':field1,'bookno':field2,'typee':typee},
            error: function() {
                alert("404");
            },
            success: function(data) {
                //alert(data.result);
                alert(data.result.vvalue_x);
                alert(data.result.vvalue_y);
                drawBarChart1(data.result);
            }
        })

    }; 
    //自动加载钢种
    function loadGrape_chen(){ 
          $.ajax({
         type: "POST",
         dataType:"json",
         url: "/getGrape" ,
         data: {'greet':'hello'},
         success: function(data){
            //alert(data.result);
            //alert(data.result.length);
            pnames=data.result;
            $(".gangzhong_name").append("<option value='blank' selected =\"selected\"></option>");
            for(var pname in pnames){
                console.log(pnames[pname]) 
                $(".gangzhong_name").append("<option value='"+pnames[pname]+"'>"+pnames[pname]+"</option>");
            }
        },
        error: function () {
            alert("error");
            }
         });
        };
        
    //初始化
    $(function(){
            loadOption_chen();
            loadGrape_chen();

        })
</script>
{% endblock %}